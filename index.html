<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rocell Gadget | Katalog HP</title>

<meta name="description" content="Rocell Gadget - Jual beli HP aman & terpercaya" />

<style>
:root{
  --bg:#ffffff;
  --card:#f8fafc;
  --border:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#2563eb;
  --danger:#dc2626;
  --wa:#22c55e;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
}
.container{max-width:1100px;margin:24px auto;padding:0 16px}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:24px;
}
.brand{
  display:flex;
  align-items:center;
  gap:12px;
}
.brand img{
  height:44px;
}
.brand h1{
  margin:0;
  font-size:1.25rem;
}

button{
  padding:8px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#fff;
  cursor:pointer;
}
button.primary{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
button.danger{
  background:var(--danger);
  color:#fff;
  border-color:var(--danger);
}

.admin{
  margin-bottom:24px;
  padding:16px;
  border:1px dashed var(--border);
  border-radius:12px;
}

input{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid var(--border);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:16px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.card img{
  width:100%;
  height:180px;
  object-fit:contain;
  background:#fff;
}
.card .info{
  padding:12px;
  flex:1;
}
.card h3{
  margin:0 0 6px;
  font-size:1rem;
}
.price{
  font-weight:700;
  color:var(--accent);
  margin-bottom:8px;
}
.card a{
  margin:12px;
  text-align:center;
  background:var(--accent);
  color:#fff;
  padding:10px;
  border-radius:6px;
  text-decoration:none;
  font-weight:600;
}

.hidden{display:none}

.wa-float{
  position:fixed;
  right:16px;
  bottom:16px;
  background:var(--wa);
  color:#fff;
  padding:12px 16px;
  border-radius:999px;
  text-decoration:none;
  font-weight:600;
}

footer{
  margin:32px 0;
  text-align:center;
  color:var(--muted);
  font-size:13px;
}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>

<body>

<div class="container">

  <header>
    <div class="brand">
      <img src="logo-rocell.png" alt="Rocell Gadget">
      <h1>Rocell Gadget</h1>
    </div>
    <div>
      <button id="loginBtn">Login Admin</button>
      <button id="logoutBtn" class="hidden">Logout</button>
    </div>
  </header>

  <div id="adminPanel" class="admin hidden">
    <strong>ADMIN PANEL</strong><br><br>
    <input id="namaBarang" placeholder="Nama HP"><br><br>
    <input id="hargaBarang" type="number" placeholder="Harga (contoh: 12500000)"><br><br>
    <input id="fotoBarang" type="file" accept="image/*"><br><br>
    <button id="addBtn" class="primary">Simpan Barang</button>
  </div>

  <div id="produk" class="grid"></div>

  <footer>
    © Rocell Gadget · Jual Beli HP Aman & Terpercaya
  </footer>
</div>

<a class="wa-float" target="_blank"
   href="https://wa.me/6281211172228">
  WhatsApp
</a>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyAcLq0OpLMY9gfOVb7854pzaEAjqNbgHGs",
  authDomain: "rocellgadget.firebaseapp.com",
  projectId: "rocellgadget",
  storageBucket: "rocellgadget.appspot.com",
  messagingSenderId: "451065886878",
  appId: "1:451065886878:web:e3f291259be532f8a5638f"
};
const ADMIN_EMAIL = "mahakaryahutama.corp@gmail.com";

/* ================= INIT ================= */
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

/* ================= AUTH ================= */
loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};
logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  const admin = user && user.email === ADMIN_EMAIL;
  adminPanel.classList.toggle("hidden", !admin);
  loginBtn.classList.toggle("hidden", admin);
  logoutBtn.classList.toggle("hidden", !admin);
});

/* ================= LOAD PRODUK ================= */
db.collection("items").orderBy("createdAt","desc")
.onSnapshot(snap => {
  produk.innerHTML = "";
  snap.forEach(doc => {
    const d = doc.data();
    const harga = "Rp " + d.harga.toLocaleString("id-ID");
    const pesan = encodeURIComponent(
      `Halo Rocell Gadget, saya tertarik dengan ${d.nama} (${harga})`
    );

    produk.innerHTML += `
      <div class="card">
        <img src="${d.gambar || 'https://via.placeholder.com/300?text=Rocell+Gadget'}">
        <div class="info">
          <h3>${d.nama}</h3>
          <div class="price">${harga}</div>
        </div>
        <a target="_blank"
          href="https://wa.me/6281211172228?text=${pesan}">
          Chat WhatsApp
        </a>
        ${auth.currentUser && auth.currentUser.email === ADMIN_EMAIL ? `
        <div style="display:flex;gap:8px;padding:12px">
          <button onclick="editFoto('${doc.id}','${d.gambar || ""}')">Edit Foto</button>
          <button class="danger" onclick="hapusBarang('${doc.id}','${d.gambar || ""}')">
            Hapus
          </button>
        </div>` : ""}
      </div>`;
  });
});

/* ================= TAMBAH BARANG ================= */
addBtn.onclick = async () => {
  const nama = namaBarang.value.trim();
  const harga = Number(hargaBarang.value);
  const file = fotoBarang.files[0];

  if(!nama || !harga) return alert("Nama & harga wajib diisi");

  let fotoURL = "";
  if(file){
    const ref = storage.ref("produk/" + Date.now() + "_" + file.name);
    const snap = await ref.put(file);
    fotoURL = await snap.ref.getDownloadURL();
  }

  await db.collection("items").add({
    nama,
    harga,
    gambar: fotoURL,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  namaBarang.value = "";
  hargaBarang.value = "";
  fotoBarang.value = "";
};

/* ================= HAPUS ================= */
async function hapusBarang(id, foto){
  if(!confirm("Hapus barang ini?")) return;
  if(foto) await storage.refFromURL(foto).delete();
  await db.collection("items").doc(id).delete();
}

/* ================= EDIT FOTO ================= */
async function editFoto(id, fotoLama){
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.onchange = async () => {
    const file = input.files[0];
    if(!file) return;

    const ref = storage.ref("produk/" + Date.now() + "_" + file.name);
    const snap = await ref.put(file);
    const fotoBaru = await snap.ref.getDownloadURL();

    await db.collection("items").doc(id).update({ gambar: fotoBaru });
    if(fotoLama) await storage.refFromURL(fotoLama).delete();
  };
  input.click();
}
</script>

</body>
</html>
