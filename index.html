<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rocell Gadget | Premium Smartphone Store OKU Timur</title>
<meta name="description" content="Rocell Gadget - Jual Beli Tukar Tambah HP Berkualitas di BK 9 OKUTIMUR" />
<link rel="icon" href="rocell_gadget_logo.png" />

<!-- Google Fonts: Plus Jakarta Sans & Space Grotesk -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
/* --- Variabel Warna & Font --- */
:root {
  --primary: #0062ff; /* Biru cerah */
  --secondary: #00f2fe; /* Cyan cerah */
  --accent: #ff007a; /* Merah muda keunguan */
  --bg-body: #f4f7ff; /* Latar belakang body */
  --card-shadow: 0 20px 40px rgba(0, 98, 255, 0.08);
  --grad-linear: linear-gradient(135deg, #0062ff 0%, #00f2fe 100%);
  --skeleton-gradient: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
}

/* --- Global & Body Styles --- */
body {
  background-color: var(--bg-body);
  color: #1e293b;
  font-family: 'Plus Jakarta Sans', sans-serif;
  overflow-x: hidden; /* Mencegah scrollbar horizontal yang tidak diinginkan */
}

/* --- Background Decoration (Blobs) --- */
.bg-blob {
  position: fixed; width: 500px; height: 500px;
  background: radial-gradient(circle, rgba(0, 98, 255, 0.05) 0%, transparent 70%);
  z-index: -1; border-radius: 50%;
  animation: blobMove 20s infinite alternate; /* Animasi bergerak */
}
.bg-blob.top-left { top: -100px; left: -100px; }
.bg-blob.bottom-right { bottom: -150px; right: -150px; animation-delay: 5s; }

@keyframes blobMove {
  0% { transform: translate(0, 0) scale(1); }
  50% { transform: translate(50px, 30px) scale(1.1); }
  100% { transform: translate(0, 0) scale(1); }
}

/* --- Navbar Premium & Address Area --- */
.navbar-custom {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  padding: 12px 0;
  border-bottom: 1px solid rgba(0, 98, 255, 0.1);
  position: sticky; top: 0; z-index: 1000;
  box-shadow: 0 4px 30px rgba(0,0,0,0.03);
}

.brand-logo { height: 55px; transition: 0.3s ease; border-radius: 12px; }

.address-text {
  font-size: 0.8rem;
  line-height: 1.2;
  color: #64748b;
  max-width: 250px;
  display: block;
}

/* --- Hero Section --- */
.hero-wrapper {
  background: var(--grad-linear);
  border-radius: 40px;
  padding: 80px 40px;
  color: white;
  text-align: center;
  position: relative;
  overflow: hidden;
  margin-top: 30px;
  box-shadow: 0 25px 50px -12px rgba(0, 98, 255, 0.4);
}
.hero-wrapper::before { /* Efek overlay gradient pada hero */
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(circle at top left, rgba(255,255,255,0.1) 0%, transparent 70%);
    pointer-events: none;
    border-radius: 40px;
}

.hero-title {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 3.5rem;
  line-height: 1.1;
  margin-bottom: 20px;
  text-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

/* --- Search Bar --- */
.search-box-wrap {
  max-width: 700px; margin: -40px auto 50px; position: relative; z-index: 100;
}
.search-input {
  height: 70px; border-radius: 20px; padding: 0 30px;
  font-size: 1.1rem; font-weight: 600;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  border: 2px solid transparent; /* Default border */
  transition: border-color 0.3s ease;
}
.search-input:focus {
  border-color: var(--primary); /* Highlight border on focus */
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15), 0 0 0 4px rgba(0, 98, 255, 0.2); /* Enhanced shadow */
}


/* --- Product Grid & Card --- */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 30px; padding: 20px 0;
}

.card-item {
  background: white; border-radius: 35px; border: 1px solid rgba(0,0,0,0.02);
  padding: 20px; position: relative; transition: all 0.5s ease;
  display: flex; flex-direction: column; height: 100%;
}

.card-item:hover {
  transform: translateY(-15px);
  box-shadow: var(--card-shadow);
  border-color: var(--primary);
  /* Optional: Add a subtle rotating effect */
  animation: cardHoverPop 0.3s forwards;
}
@keyframes cardHoverPop {
    from { transform: translateY(0); }
    to { transform: translateY(-15px); }
}


.image-container {
  background: #f8fbff; border-radius: 25px; height: 260px;
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 20px; overflow: hidden;
}

.image-container img { max-width: 85%; max-height: 85%; object-fit: contain; transition: 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
.card-item:hover .image-container img { transform: scale(1.1) rotate(3deg); }

.tag-exclusive {
  position: absolute; top: 25px; left: 25px;
  background: var(--accent); color: white; padding: 5px 15px;
  border-radius: 50px; font-size: 0.7rem; font-weight: 800;
  text-transform: uppercase; z-index: 5;
  box-shadow: 0 5px 15px rgba(255, 0, 122, 0.3);
}

.product-name { font-weight: 800; font-size: 1.3rem; color: #111827; }
.product-price { font-family: 'Space Grotesk', sans-serif; font-size: 1.6rem; color: var(--primary); margin-bottom: 20px; }

/* --- Call to Action Button --- */
.btn-deal {
  background: var(--grad-linear); color: white; border: none;
  padding: 15px; border-radius: 18px; font-weight: 800;
  text-decoration: none; display: flex; align-items: center; justify-content: center;
  gap: 10px; transition: 0.3s;
  box-shadow: 0 10px 25px rgba(0, 98, 255, 0.25);
}

.btn-deal:hover { color: white; filter: brightness(1.1); transform: scale(1.02); box-shadow: 0 12px 30px rgba(0, 98, 255, 0.35); }

/* --- Floating WhatsApp Button --- */
.wa-float {
  position: fixed; bottom: 30px; right: 30px; width: 65px; height: 65px;
  background: #25d366; color: white; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 30px; z-index: 1000; text-decoration: none;
  box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4);
  animation: pulseInfinite 2s infinite;
}

@keyframes pulseInfinite {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
  70% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
}

/* --- Admin Toolbar --- */
#adminToolbar {
  background: white; border-radius: 25px; padding: 25px;
  margin-bottom: 40px; border: 2px dashed var(--primary);
}

/* --- Utility Class --- */
.hidden { display: none !important; }

/* --- Footer --- */
footer { margin: 80px 0 40px; text-align: center; color: #94a3b8; font-size: 0.9rem; }

/* --- Skeleton Loader --- */
.skeleton-loader {
    background: #f0f0f0;
    background: var(--skeleton-gradient);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 10px;
}

.skeleton-loader-card {
    height: 100%; /* Ensure card occupies full height */
    padding: 20px;
    background: white;
    border-radius: 35px;
    border: 1px solid rgba(0,0,0,0.02);
    display: flex;
    flex-direction: column;
}
.skeleton-loader-card .image-placeholder {
    height: 260px;
    background: #f8fbff;
    border-radius: 25px;
    margin-bottom: 20px;
}
.skeleton-loader-card .text-placeholder {
    height: 20px;
    margin-bottom: 10px;
}
.skeleton-loader-card .text-placeholder.long { width: 80%; }
.skeleton-loader-card .text-placeholder.short { width: 60%; }
.skeleton-loader-card .button-placeholder {
    height: 50px;
    border-radius: 18px;
    margin-top: auto; /* Push button to bottom */
}


@keyframes loading {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* --- Media Queries --- */
@media (max-width: 768px) {
  .hero-title { font-size: 2.2rem; }
  .address-text { display: none; } /* Sembunyikan alamat di mobile agar tidak sesak */
  .hero-wrapper { padding: 60px 20px; }
  .navbar-custom .container { flex-direction: column; align-items: flex-start; }
  .navbar-custom .d-flex.gap-2 { margin-top: 10px; width: 100%; justify-content: space-around; }
}
</style>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>

<body>

<!-- Background Blobs for Visual Appeal -->
<div class="bg-blob top-left"></div>
<div class="bg-blob bottom-right"></div>

<!-- Custom Navbar -->
<nav class="navbar-custom">
  <div class="container d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-3">
      <img src="rocell_gadget_logo.png" class="brand-logo" alt="Rocell Logo">
      <div>
        <span class="fw-bold fs-5 d-block" style="letter-spacing: -1px; line-height: 1;">ROCELL <span style="color:var(--primary)">GADGET</span></span>
        <span class="address-text">
            <i class="bi bi-geo-alt-fill text-danger"></i> Jl. Raya Pasar Sidodadi BK 9, OKU Timur, Sumsel
        </span>
      </div>
    </div>
    <div class="d-flex gap-2">
      <button id="loginBtn" class="btn btn-outline-primary rounded-pill fw-bold px-4">Admin</button>
      <button id="logoutBtn" class="btn btn-danger rounded-pill fw-4 px-4 hidden">Logout</button>
    </div>
  </div>
</nav>

<div class="container">
 
  <!-- Hero Section -->
  <div id="heroSection" class="hero-wrapper animate-on-scroll" data-animation="animate__fadeIn">
    <h1 class="hero-title">SIKAT GADGET <br> IMPIANMU SEKARANG!</h1>
    <p class="opacity-75 fs-5">HP Berkelas, harga pas, Buat Tetangga Makin Panas.</p>
  </div>

  <!-- Search Bar -->
  <div id="searchSection" class="search-box-wrap animate-on-scroll" data-animation="animate__fadeInUp">
    <input type="search" id="searchInput" class="form-control search-input" placeholder="Cari iPhone, Samsung, atau unit lainnya..." />
  </div>

  <!-- Admin Toolbar -->
  <div id="adminToolbar" class="hidden animate-on-scroll" data-animation="animate__fadeIn" data-stagger="0.2">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <h4 class="fw-bold mb-0">ADMIN DASHBOARD</h4>
        <button id="addBtn" class="btn btn-primary btn-lg rounded-pill px-5 fw-bold shadow-lg"><i class="bi bi-plus-lg me-2"></i>Tambah Unit</button>
    </div>
  </div>

  <!-- Product Grid -->
  <div id="produk" class="grid">
    <!-- Produk akan dimuat di sini -->
  </div>
 
  <!-- Product Placeholder (Skeleton Loaders) -->
  <div id="product-placeholder" class="grid">
      <!-- Skeleton loaders akan dimuat di sini -->
  </div>

  <!-- Footer -->
  <footer id="footerSection" class="animate-on-scroll" data-animation="animate__fadeInUp" data-stagger="0.3">
    <p>Rocell Gadget Store<br>Jalan raya pasar sidodadi bk 9, OKU Timur, Sumatra Selatan<br>© 2024 All Rights Reserved.</p>
  </footer>
</div>

<!-- Floating WhatsApp Button -->
<a class="wa-float" target="_blank" href="https://wa.me/6281211172228">
  <i class="bi bi-whatsapp"></i>
</a>

<!-- Modal untuk Tambah/Edit Produk -->
<div class="modal fade" id="modalItem" tabindex="-1" aria-labelledby="modalItemTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 30px; overflow: hidden;">
      <div class="modal-header bg-primary text-white p-4">
        <h5 class="modal-title fw-bold" id="modalItemTitle">Update Unit</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <input type="hidden" id="mId" />
        <input type="hidden" id="mGambarLama" />
        <div class="mb-3">
          <label for="mNama" class="form-label fw-bold">Nama Gadget</label>
          <input id="mNama" class="form-control rounded-3" placeholder="iPhone 13 Pro Max" />
        </div>
        <div class="mb-3">
          <label for="mHarga" class="form-label fw-bold">Harga Deal (Rp)</label>
          <input id="mHarga" type="number" class="form-control rounded-3" placeholder="10000000" />
        </div>
        <div class="mb-3">
          <label for="mGambar" class="form-label fw-bold">Foto Unit</label>
          <input id="mGambar" type="file" class="form-control rounded-3" accept="image/*" />
        </div>
      </div>
      <div class="modal-footer border-0 p-4">
        <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Batal</button>
        <button id="btnSaveItem" type="button" class="btn btn-primary rounded-pill px-5 fw-bold">SIMPAN SEKARANG</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JavaScript Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// --- KONFIGURASI FIREBASE ---
const firebaseConfig = {
  apiKey: "AIzaSyAcLq0OpLMY9gfOVb7854pzaEAjqNbgHGs",
  authDomain: "rocellgadget.firebaseapp.com",
  projectId: "rocellgadget",
  storageBucket: "rocellgadget.appspot.com",
  appId: "1:451065886878:web:e3f291259be532f8a5638f"
};
const ADMIN_EMAIL = "mahakaryahutama.corp@gmail.com";

// --- STATE APLIKASI ---
let appState = {
  isAdmin: false,
  products: [],
  unsubscribeFirestore: null, // Untuk mengelola listener Firestore
  isInitialLoad: true // Menandakan apakah ini pemuatan awal untuk skeleton
};

// --- INISIALISASI FIREBASE ---
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// --- UTILITY DOM SELECTOR ---
const el = id => document.getElementById(id);
let itemModal; // Deklarasi global untuk instance modal Bootstrap

// --- FUNGSI SKELETON LOADER ---
function showSkeletonLoaders(count = 6) {
    const placeholderContainer = el('product-placeholder');
    placeholderContainer.innerHTML = ''; // Kosongkan placeholder sebelumnya
    placeholderContainer.classList.remove('hidden'); // Tampilkan placeholder
    el('produk').classList.add('hidden'); // Sembunyikan produk asli
    for (let i = 0; i < count; i++) {
        placeholderContainer.innerHTML += `
            <div class="skeleton-loader-card">
                <div class="image-placeholder skeleton-loader"></div>
                <div class="flex-grow-1 d-flex flex-column">
                    <div class="text-placeholder skeleton-loader long mb-2"></div>
                    <div class="text-placeholder skeleton-loader short mb-4"></div>
                    <div class="button-placeholder skeleton-loader"></div>
                </div>
            </div>
        `;
    }
}

function hideSkeletonLoaders() {
    el('product-placeholder').classList.add('hidden');
    el('produk').classList.remove('hidden');
}


// --- FUNGSI RENDER PRODUK ---
function renderProducts(filter = '') {
    const container = el('produk');
    container.innerHTML = ''; // Kosongkan produk sebelumnya

    const productsToShow = appState.products.filter(p =>
        p.nama.toLowerCase().includes(filter.toLowerCase())
    );

    if (productsToShow.length === 0) {
        container.innerHTML = `<p class="py-5 text-secondary fw-bold text-center w-100">Unit tidak ditemukan.</p>`;
        hideSkeletonLoaders(); // Pastikan skeleton disembunyikan jika tidak ada produk
        return;
    }

    productsToShow.forEach((item, idx) => {
        const hargaStr = "Rp " + (item.harga || 0).toLocaleString("id-ID");
        const waLink = `https://wa.me/6281211172228?text=Halo%20Rocell%20Gadget%2C%20saya%20mau%20order%20*${encodeURIComponent(item.nama)}*%20(${hargaStr}).%20Unit%20ready?`;
       
        const card = document.createElement('div');
        card.className = `card-item animate__animated animate__fadeInUp`;
        card.style.animationDelay = `${idx * 0.08}s`; // Staggered animation
        card.innerHTML = `
            <div class="tag-exclusive">Original</div>
            <div class="image-container">
                <img src="${item.gambar || 'https://via.placeholder.com/400'}" alt="${item.nama}">
            </div>
            <div class="flex-grow-1">
                <h3 class="product-name">${item.nama}</h3>
                <div class="product-price">${hargaStr}</div>
            </div>
            <a class="btn-deal" target="_blank" href="${waLink}">
                <i class="bi bi-cart-plus-fill"></i> SIKAT SEKARANG
            </a>
            ${appState.isAdmin ? `
            <div class="d-flex gap-2 mt-3 pt-3 border-top">
                <button class="btn btn-sm btn-outline-dark flex-grow-1 rounded-pill" onclick="window.openModal('${item.id}')">Edit</button>
                <button class="btn btn-sm btn-outline-danger flex-grow-1 rounded-pill" onclick="window.deleteItem('${item.id}', '${item.gambar || ''}')">Hapus</button>
            </div>` : ""}
        `;
        container.appendChild(card);
    });
    hideSkeletonLoaders(); // Sembunyikan skeleton setelah produk dirender
}

// --- FUNGSI AMBIL DATA REALTIME DARI FIRESTORE ---
function fetchRealtimeData() {
    // Jika sudah ada listener, hentikan dulu
    if (appState.unsubscribeFirestore) {
        appState.unsubscribeFirestore();
    }

    if (appState.isInitialLoad) {
        showSkeletonLoaders(); // Tampilkan skeleton saat pertama kali memuat
    }

    appState.unsubscribeFirestore = db.collection("items").orderBy("createdAt", "desc")
        .onSnapshot(
            (snapshot) => {
                appState.products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderProducts(el('searchInput').value);
                appState.isInitialLoad = false; // Setelah pemuatan awal selesai
            },
            (error) => {
                console.error("Error fetching Firestore data:", error);
                el('produk').innerHTML = "<p class='py-5 text-center text-danger fw-bold w-100'>Gagal memuat produk. Terjadi kesalahan.</p>";
                hideSkeletonLoaders();
                appState.isInitialLoad = false;
            }
        );
}

// --- FUNGSI MODAL TAMBAH/EDIT ---
window.openModal = (id = null) => {
    itemModal.show();
    const isEdit = id !== null;
    el('mId').value = id || '';
    el('modalItemTitle').innerText = isEdit ? "Edit Unit" : "Tambah Unit Baru";

    if (isEdit) {
        const p = appState.products.find(x => x.id === id);
        if (p) {
            el('mNama').value = p.nama || '';
            el('mHarga').value = p.harga || '';
            el('mGambarLama').value = p.gambar || '';
        }
    } else {
        el('mNama').value = '';
        el('mHarga').value = '';
        el('mGambarLama').value = '';
        el('mGambar').value = ''; // Reset input file
    }
};

// --- FUNGSI SIMPAN ITEM (TAMBAH/EDIT) ---
window.saveItem = async () => {
    const btn = el('btnSaveItem');
    const id = el('mId').value;
    const file = el('mGambar').files[0];
    const nama = el('mNama').value.trim();
    const harga = Number(el('mHarga').value);

    if (!nama || isNaN(harga) || harga <= 0) {
        alert("Mohon lengkapi Nama Gadget dan Harga yang valid!");
        return;
    }

    btn.disabled = true;
    btn.innerHTML = "<span class='spinner-border spinner-border-sm' role='status' aria-hidden='true'></span> Menyimpan...";

    try {
        let url = el('mGambarLama').value; // URL gambar lama jika ada
        if (file) {
            // Upload gambar baru
            const ref = storage.ref(`produk/${Date.now()}_${file.name}`);
            await ref.put(file);
            url = await ref.getDownloadURL();
           
            // Hapus gambar lama jika ada dan berbeda dari yang baru
            if (el('mGambarLama').value && el('mGambarLama').value !== url && el('mGambarLama').value.includes("firebasestorage")) {
                try { await storage.refFromURL(el('mGambarLama').value).delete(); } catch(e) { console.warn("Could not delete old image:", e); }
            }
        } else if (!id && !url) { // Jika menambah baru dan tidak ada file, serta tidak ada gambar lama
            alert("Mohon pilih foto unit!");
            return;
        }

        const data = { nama, harga, gambar: url };

        if (id) {
            await db.collection("items").doc(id).update(data);
        } else {
            data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            await db.collection("items").add(data);
        }
        itemModal.hide();
    } catch (err) {
        console.error("Error saving item:", err);
        alert("Gagal menyimpan item: " + err.message);
    } finally {
        btn.disabled = false;
        btn.innerHTML = "SIMPAN SEKARANG";
    }
};

// --- FUNGSI HAPUS ITEM ---
window.deleteItem = async (id, imageUrl) => {
    if (confirm("Apakah Anda yakin ingin menghapus unit ini?")) {
        try {
            await db.collection("items").doc(id).delete();
            // Hapus gambar dari Storage jika ada
            if (imageUrl && imageUrl.includes("firebasestorage")) {
                try {
                    await storage.refFromURL(imageUrl).delete();
                } catch(e) {
                    // Log error but don't prevent item deletion from Firestore
                    console.warn("Gagal menghapus gambar dari Storage:", e);
                }
            }
            alert("Unit berhasil dihapus!");
        } catch (err) {
            console.error("Error deleting item:", err);
            alert("Gagal menghapus unit: " + err.message);
        }
    }
};

// --- INTERSECTION OBSERVER UNTUK ANIMASI SCROLL ---
function setupIntersectionObserver() {
    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const target = entry.target;
                const animationClass = target.dataset.animation || 'animate__fadeIn'; // Default animation
                const staggerDelay = parseFloat(target.dataset.stagger) || 0;

                // Add animation classes
                target.classList.add('animate__animated', animationClass);
                target.style.animationDelay = `${staggerDelay}s`;
               
                // Stop observing once animated
                observer.unobserve(target);
            }
        });
    }, { threshold: 0.1 }); // Trigger when 10% of the element is visible

    document.querySelectorAll('.animate-on-scroll').forEach(element => {
        observer.observe(element);
    });

    // Observe product cards after they are rendered
    // This part will be handled within renderProducts if product cards are dynamic
}

// --- EVENT LISTENERS ---
document.addEventListener('DOMContentLoaded', () => {
    itemModal = new bootstrap.Modal(el('modalItem')); // Inisialisasi modal Bootstrap

    // Autentikasi Firebase
    auth.onAuthStateChanged(user => {
        appState.isAdmin = user && user.email === ADMIN_EMAIL;
        el('adminToolbar').classList.toggle('hidden', !appState.isAdmin);
        el('loginBtn').classList.toggle('hidden', appState.isAdmin);
        el('logoutBtn').classList.toggle('hidden', !appState.isAdmin);
        fetchRealtimeData(); // Panggil setelah status admin diketahui
    });

    // Tombol Login/Logout
    el('loginBtn').onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    el('logoutBtn').onclick = () => auth.signOut();

    // Tombol Tambah Unit
    el('addBtn').onclick = () => window.openModal();
    // Tombol Simpan di Modal
    el('btnSaveItem').onclick = window.saveItem;

    // Search Input
    el('searchInput').oninput = (e) => renderProducts(e.target.value);

    // Setup Intersection Observer for initial animations
    setupIntersectionObserver();
});

</
